# PR-Service - Тестовое задание

## Быстрый старт

`git clone https://github.com/oooooorg/PR-Service.git`   
``docker-compose up``

После успешного старта, API будет доступно по адресу localhost:8080.  

## Технологический стек

| Технология | Версия     | Назначение                    |
|------------|------------|-------------------------------|
| **Go** | 1.24.1     | Язык программирования         |
| **Echo** | v4         | HTTP Framework                |
| **PostgreSQL** | 15         | Реляционная БД                |
| **slog** | built-in   | Структурированное логирование |
| **Prometheus** | latest     | Метрики                       |
| **Grafana** | Enterprise | Визуализация                  |
| **k6** | latest     | Нагрузочное тестирование      |
| **golangci-lint** | latest     | Статический анализ            |
| **Docker Compose** | v3.8       | Контейнеризация               |

### Порты сервисов

| Сервис | Порт | URL                   |
|--------|------|-----------------------|
| API | 8080 | http://localhost:8080 |
| PostgreSQL | 5432 | http://localhost:5432 |
| Prometheus | 9090 | http://localhost:9090 |
| Grafana | 3000 | http://localhost:3000 |

#### Данные подключения к БД и пользователь по умолчанию

Изначально подключение БД и пользователь создаются по описанным в `config.yml` и `docker-compose.yml` файлах. **При желании**, их можно изменить. Отредактируйте `config.yml` (для локального запуска)
Отредактируйте `docker-compose.yml` (для Docker):

**config.yml**
```database:   
host: ""   
port: ""  
user: ""  
password: ""  
dbname: ""
```


**docker-compose.yml**
```
- DB_HOST=
- DB_PORT=
- DB_USER=
- DB_PASSWORD=
- DB_NAME=
- DB_SSLMODE=
```


## Дополнительные задания

### Эндпоинт статистики

Статистика будет доступна по `localhost:8080/metrics` и `localhost:3000` через Grafana. Datasource через Prometheus.
В Grafana автоматически создается Dashboard, отображающий RPS, Latency, Запросы по ендпоинтам, Ответы по эндпоинтам, процент ошибок и др.

### Нагрузочное тестирование

Реализовано нагрузочное тестирование через `k6`. Результаты видны на файле `results-load-test.png`
Длительность: 7 минут
**Этапы нагрузки:**
- 0-30s: разогрев до 10 VUs
- 30s-1m30s: рост до 50 VUs
- 1m30s-3m30s: стабилизация на 50 VUs
- 3m30s-4m30s: рост до 100 VUs
- 4m30s-6m30s: пиковая нагрузка 100 VUs
- 6m30s-7m: graceful shutdown

**Сценарий:**
1. Создание PR с автоматическим назначением ревьюеров
2. Получение списка PR для ревью (2 запроса)
3. Все операции выполняются параллельно 100 VUs

![Статистика](results-load-test.png)

Для запуска 

``
docker-compose --profile load-test run --rm k6 run /scripts/create-pr-test.js
``

### Конфигурация линтера

Описана конфигурация линтера в файле `.golangci.yml`

## Решения, не описанные в тз

- На неправильные, с моей точки зрения, и неописанные запросы в `openapi` ситуации и запросы обрабатываются 500 кодом ошибки.  
- Логировние реализовано через `slog`. 
- В `/pullRequest/reassign` одно из required полей было поменяно на `old_user_id` для совместимости со сгенерированным по спеке файлу.
